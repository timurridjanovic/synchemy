{"version":3,"sources":["../src/client.js"],"names":["callListeners","listeners","changes","store","loaders","Object","values","forEach","listener","subscribeCallback","prevState","containsChange","entries","change","undefined","debouncePerAnimationFrame","func","params","debounce","window","cancelAnimationFrame","requestAnimationFrame","isOpen","ws","readyState","OPEN","isConnecting","CONNECTING","SynchemyClient","host","protocols","actions","client","onMessage","queue","asyncActions","Error","createConnection","action","registerAction","name","options","WebSocket","onmessage","data","response","JSON","parse","message","messageId","find","m","resolve","updateStore","processResponse","newResult","filter","onerror","error","onclose","event","code","navigator","onLine","mapStateToProps","state","callback","shouldUpdate","newState","newChanges","listenerId","_","otherListeners","Promise","reject","getMessage","newMessage","push","send","stringify","onopen","actionName","getAction","throttle","newAction","methodName","split","map","word","index","toLowerCase","substring","toUpperCase","join","loading"],"mappings":"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","sourcesContent":["import { v4 as uuid } from 'uuid'\nimport { debounce, throttle } from 'lodash'\n\nconst callListeners = (listeners, changes, store, loaders) => {\n  Object.values(listeners).forEach(listener => {\n    listener.subscribeCallback(listener.prevState, changes, store, loaders, listener)\n  })\n}\n\nconst containsChange = (changes, prevState) => {\n  for (const change of Object.entries(changes)) {\n    if (change[1] !== undefined && prevState[change[0]] !== change[1]) {\n      return true\n    }\n  }\n\n  return false\n}\n\nconst debouncePerAnimationFrame = (func, params) => {\n  // If there's a pending function call, cancel it\n  if (func.debounce) {\n    window.cancelAnimationFrame(func.debounce)\n  }\n  // Setup the new function call to run at the next animation frame\n  func.debounce = window.requestAnimationFrame(() => {\n    func(params)\n  })\n}\n\nconst isOpen = ws => {\n  return ws.readyState === ws.OPEN\n}\n\nconst isConnecting = ws => {\n  return ws.readyState === ws.CONNECTING\n}\n\nclass SynchemyClient {\n  store = {}\n  actions = {}\n  asyncActions = {}\n  #messagingManager = {\n    client: null,\n    host: null,\n    onMessage: null,\n    listeners: {},\n    queue: [],\n    asyncActions: {}\n  }\n\n  constructor ({ host, protocols = [], actions = {} }) {\n    if (!host) {\n      throw new Error('You must provide a host to connect to.')\n    }\n\n    this.createConnection({ host, protocols })\n\n    Object.values(actions).forEach(action => {\n      this.registerAction(action.name, action.action, action.options)\n    })\n  }\n\n  createConnection ({ host, protocols = [] }) {\n    this.#messagingManager.host = host\n    this.#messagingManager.client = new WebSocket(host, protocols)\n    this.#messagingManager.client.onmessage = ({ data }) => {\n      const response = JSON.parse(data)\n      const { message, messageId } = response\n      if (messageId) {\n        const { resolve, options } = this.#messagingManager.queue.find(m => m.message.messageId === messageId)\n        const { updateStore, processResponse } = options\n        const newResult = processResponse ? processResponse(message) : message\n        if (updateStore !== false) {\n          this.store = { ...this.store, ...newResult }\n          callListeners(this.#messagingManager.listeners, {\n            store: newResult,\n            loaders: this.#messagingManager.asyncActions\n          }, this.store, this.asyncActions)\n        }\n\n        resolve(newResult)\n        this.#messagingManager.queue = this.#messagingManager.queue.filter(m => m.message.messageId !== messageId)\n      } else {\n        if (this.#messagingManager.onMessage) {\n          this.#messagingManager.onMessage(message)\n        } else {\n          this.store = { ...this.store, ...message }\n          callListeners(this.#messagingManager.listeners, {\n            store: message,\n            loaders: this.#messagingManager.asyncActions\n          }, this.store, this.asyncActions)\n        }\n      }\n    }\n\n    this.#messagingManager.client.onerror = error => {\n      throw new Error(error)\n    }\n\n    this.#messagingManager.client.onclose = event => {\n      if (event.code !== 1000) {\n        // Error code 1000 means that the connection was closed normally.\n        if (!navigator.onLine) {\n          throw new Error('You are offline. Please connect to the Internet and try again.')\n        }\n      }\n    }\n  }\n\n  subscribe (mapStateToProps = state => state, callback, shouldUpdate) {\n    const store = this.store\n    const loaders = this.asyncActions\n    const prevState = mapStateToProps(store, loaders)\n    const subscribeCallback = (prevState, changes, store, loaders, listener) => {\n      if (listener.shouldUpdate) {\n        const newState = mapStateToProps(store, loaders)\n        if (listener.shouldUpdate(prevState, newState)) {\n          listener.prevState = newState\n          return debouncePerAnimationFrame(callback, newState)\n        }\n        return\n      }\n\n      const newChanges = mapStateToProps(changes.store, changes.loaders)\n      if (containsChange(newChanges, prevState)) {\n        const newState = mapStateToProps(store, loaders)\n        listener.prevState = newState\n        return debouncePerAnimationFrame(callback, newState)\n      }\n    }\n\n    const listener = { subscribeCallback, prevState, shouldUpdate }\n    const listenerId = uuid()\n    this.#messagingManager.listeners[listenerId] = listener\n    return listenerId\n  }\n\n  unsubscribe (listenerId) {\n    const { [listenerId]: _, ...otherListeners } = this.#messagingManager.listeners\n    this.#messagingManager.listeners = otherListeners\n  }\n\n  onMessage (func) {\n    this.#messagingManager.onMessage = func\n  }\n\n  send (message, options = {}) {\n    return new Promise((resolve, reject) => {\n      const getMessage = message => {\n        if (typeof message === 'function') {\n          return message(this.store)\n        }\n\n        return message\n      }\n      const newMessage = { message: getMessage(message), messageId: uuid() }\n      this.#messagingManager.queue.push({ message: newMessage, resolve, options })\n      if (isOpen(this.#messagingManager.client)) {\n        this.#messagingManager.client.send(JSON.stringify(newMessage))\n      } else {\n        if (!isConnecting(this.#messagingManager.client)) {\n          this.createConnection({ host: this.#messagingManager.host })\n        }\n\n        this.#messagingManager.client.onopen = () => {\n          this.#messagingManager.client.send(JSON.stringify(newMessage))\n        }\n      }\n    })\n  }\n\n  updateStore (state) {\n    if (typeof state === 'function') {\n      const newState = state(this.store)\n      this.store = { ...this.store, ...newState }\n\n      callListeners(this.#messagingManager.listeners, {\n        store: newState, loaders: this.#messagingManager.asyncActions\n      }, this.store, this.asyncActions)\n    } else {\n      this.store = { ...this.store, ...state }\n\n      callListeners(this.#messagingManager.listeners, {\n        store: state,\n        loaders: this.#messagingManager.asyncActions\n      }, this.store, this.asyncActions)\n    }\n  }\n\n  registerAction (actionName, action, options = {}) {\n    const getAction = (action, options) => {\n      if (options.debounce) {\n        return debounce(action, options.debounce)\n      }\n\n      if (options.throttle) {\n        return throttle(action, options.throttle)\n      }\n\n      return action\n    }\n\n    const newAction = getAction(action, options)\n    const methodName = actionName.split('_').map((word, index) => {\n      if (index === 0) {\n        return word.toLowerCase()\n      }\n\n      return `${word.substring(0, 1).toUpperCase()}${word.substring(1).toLowerCase()}`\n    }).join('')\n\n    this.#messagingManager.asyncActions[methodName] = {}\n    this.asyncActions[methodName] = {\n      name: actionName,\n      loading: false\n    }\n\n    this.actions[methodName] = async (...args) => {\n      this.asyncActions[methodName] = {\n        ...this.asyncActions[methodName],\n        loading: true\n      }\n      const changes = {\n        store: {},\n        loaders: {\n          ...this.#messagingManager.asyncActions,\n          [methodName]: { loading: true }\n        }\n      }\n      callListeners(this.#messagingManager.listeners, changes, this.store, this.asyncActions)\n      await newAction(...args)\n      this.asyncActions[methodName] = {\n        ...this.asyncActions[methodName],\n        loading: false\n      }\n      const newChanges = {\n        store: {},\n        loaders: {\n          ...this.#messagingManager.asyncActions,\n          [methodName]: { loading: false }\n        }\n      }\n      callListeners(this.#messagingManager.listeners, newChanges, this.store, this.asyncActions)\n    }\n  }\n}\n\nexport default SynchemyClient\n"],"file":"client.js"}